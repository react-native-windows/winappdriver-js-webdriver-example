# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'windows-2019'

steps:
  - task: DownloadBuildArtifacts@0
    displayName: 'Download Build Artifacts'
    inputs:
      artifactName: drop
      downloadPath: '$(build.artifactstagingdirectory)\AppxPackages'

  - task: PowerShell@1
    displayName: 'Install Xaml Controls Cert'
    inputs:
      scriptType: inlineScript
      arguments: '-NonInteractive -Verb RunAs'
      inlineScript: |
       $file = ( Get-ChildItem -Path $(Build.ArtifactStagingDirectory)\AppxPackages\drop\XamlControlsGallery_$(PackageManifest)_Test\XamlControlsGallery_$(PackageManifest)_x86.cer )
       $file | Import-Certificate -CertStoreLocation cert:\LocalMachine\Root

  - task: PowerShell@1
    displayName: 'Install XAML Appx Packages'
    inputs:
      scriptName: '$(Build.ArtifactStagingDirectory)\AppxPackages\drop\XamlControlsGallery_$(PackageManifest)_Test\Add-AppDevPackage.ps1'
      arguments: '-NonInteractive -Force:$true  -Verb RunAs'

  - task: WinAppDriver.winappdriver-pipelines-task.winappdriver-pipelines-task.Windows Application Driver@0
    displayName: 'Start - WinAppDriver'
    inputs:
      WADArguments: 127.0.0.1 4723/wd/hub
      AgentResolution: 1080p

  - task: WinAppDriver.winappdriver-pipelines-task.winappdriver-pipelines-task.Windows Application Driver@0
    displayName: 'Stop - WinAppDriver'
    inputs:
      OperationType: Stop
